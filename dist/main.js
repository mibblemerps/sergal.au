(()=>{"use strict";window.currentSounds||(window.currentSounds=0);class e{constructor(e,t,s,i){this.game=e,this.id=t,this.name=s,this.icon=i,this.description=null,this.price=0,this.nextPurchasePriceMultiplier=1,this.merpsPerSecond=0,this.merpsMultiplier=0,this.prerequisites=[],this.unlocksAtMerps=0,this.callback=null,this.owned=0}setName(e){return this.name=e,this}setIcon(e){return this.icon=e,this}setDescription(e){return this.description=e,this}setPrice(e){return this.price=e,this}setNextPurchasePriceMultiplier(e){return this.nextPurchasePriceMultiplier=e,this}setMerpsPerSecond(e){return this.merpsPerSecond=e,this}setMerpsMultiplier(e){return this.merpsMultiplier=e,this}setPrerequisites(e){return this.prerequisites=e,this}setUnlocksAt(e){return this.unlocksAtMerps=e,this}addPrerequisite(e){return this.prerequisites.push(e),this}setCallback(e){return this.callback=e,this}setCanOnlyOwnOne(){return this.nextPurchasePriceMultiplier=null,this}increment(e=!1){e||(this.price=Math.round(this.price*this.nextPurchasePriceMultiplier)),this.owned++,this.callback&&this.callback(),this.game.buyLog.push({id:this.id,noPriceIncrease:e})}get canOnlyOwnOne(){return!this.nextPurchasePriceMultiplier}}function t(e,t,s,i,r){return r=r??document.body,s.classList.add("mote"),s.style.position="absolute",s.style.left=e+"px",s.style.top=t+"px",s.style.animationDuration=i/1e3+"s",s.ondragstart=()=>!1,0===r.childElementCount?r.appendChild(s):r.insertBefore(s,r.firstChild),setTimeout((()=>{s.remove()}),i-50),s}function s(e,t){return 0===t?Math.round(e):parseFloat(e.toString()).toFixed(t).replace(/\.?0+$/,"")}function i(e,t=1,i=!0){return e<1e3?s(e,i?0:t)+"":e<1e6?s(e/1e3,t)+"k":e<1e9?s(e/1e6,t)+"M":s(e/1e9,t)+"B"}const r=["uwu","owo",">:3",">///<","gib cheese","wedj","pointy","beep"];class n extends e{constructor(e,t,s,i,r,n,a,o=1){super(e,t,s,i),this.defaultImage=r,this.openImage=n,this.sound=a,this.volume=o,this.callback=this._callback}async _callback(){const e=document.createElement("div");e.classList.add("sergal"),e.dataset.shopId="0",e.dataset.lastMerp=(new Date).getTime().toString();const s=document.createElement("img");s.src=this.defaultImage,s.alt="Sergal",s.draggable=!1,e.appendChild(s),Game.sergalContainer.appendChild(e),Game.sergals.push(e),e.merpDown=(n,a)=>{n?.preventDefault(),a=a??1;const o=!!n;if(n&&0!==n.button)return;let l=this.merpsPerSecond*(o?Game.merpClickMultiplier:Game.merpMultiplier);if(0===l)return;s.src=this.openImage,function(e,t=1){if(currentSounds>25)return void console.warn("Reached maximum number of sounds (25).");currentSounds++;const s=document.createElement("audio");s.src=e,s.volume=t,s.play().catch((()=>{s.remove(),currentSounds--})),s.addEventListener("ended",(()=>{s.remove(),currentSounds--}))}(this.sound,this.volume);const h=e.getBoundingClientRect();let p=h.x+150*Math.random();const c=document.createElement("div");c.classList.add("merp-mote"),c.innerText="merp +"+i(l,1),Math.random()<.01&&(c.innerText=r[Math.floor(Math.random()*r.length)]),t(p,h.y,c,500),Game.merp(l*a)},e.merpUp=()=>{s.src=this.defaultImage},e.addEventListener("mousedown",e.merpDown),e.addEventListener("mouseup",e.merpUp),e.addEventListener("mouseleave",e.merpUp),e.addEventListener("touchstart",e.merpDown),e.addEventListener("touchend",e.merpUp),e.addEventListener("touchcancel",e.merpUp),e.addEventListener("contextmenu",(e=>{e.preventDefault()}));let n=new Date;for(await new Promise((e=>setTimeout(e,1e3*Math.random())));;){await new Promise((e=>setTimeout(e,250*Math.random()-125+1e3)));let t=(new Date-n)/1e3;n=new Date,e.merpDown(null,t),await new Promise((e=>setTimeout(e,100))),e.merpUp()}}}class a extends e{constructor(e,t,s,i,r,n){super(e,t,s,i),this.price=r,this.merpsMultiplier=n}get canOnlyOwnOne(){return!0}}window.Game={el:null,merps:0,highestMerps:0,_merpsLastUpdate:null,_lastUpdateAt:new Date,_lastCanAfford:null,_lastVisibleInShop:null,_autosaveEnabled:!0,sergalContainer:null,shopContainer:null,merpCountElements:null,mpsElements:null,mouseX:0,mouseY:0,sergals:[],shop:new class{constructor(){this.items=[]}byId(e){for(let t of this.items)if(t.id===e)return t;return console.warn(`No shop item with the ID "${e}"`),null}},buyLog:[],setup(){this.el=document.getElementsByTagName("main")[0],this.sergalContainer=Game.el.getElementsByClassName("sergals")[0],this.shopContainer=Game.el.getElementsByClassName("shop")[0],this.merpCountElements=Game.el.querySelectorAll("[data-merp-count]"),this.mpsElements=Game.el.querySelectorAll("[data-mps]"),this.shop.items.push(new n(this,"sergal","Sergal","merp-icon.png","img/sergal-1.png","img/sergal-2.png","merp.mp3",.5).setPrice(150).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(1).setDescription("A sergal :3").addPrerequisite("cheddar-cheese")),this.shop.items.push(new n(this,"pink-sergal","Pink Sergal","pinksergal-1.png","img/pinksergal-1.png","img/pinksergal-2.png","merp.mp3",.6).setPrice(1e3).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(4).setDescription("Happy pink sergals.").addPrerequisite("cheddar-cheese")),this.shop.items.push(new n(this,"dark-sergal","Dark Sergal","darksergal-1.png","img/darksergal-1.png","img/darksergal-2.png","merp.mp3",.7).setPrice(1e4).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(8).setDescription("These gray sergals might look scary but they're actually just as fluffy.").addPrerequisite("pink-sergal")),this.shop.items.push(new n(this,"protogen","Protogen","proto-1.png","img/proto-1.png","img/proto-2.png","beep.mp3",.5).setPrice(1e5).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(16).setDescription("digital serg").addPrerequisite("dark-sergal")),this.shop.items.push(new n(this,"synth","Synth","synth-1.png","img/synth-1.png","img/synth-2.png","beep.mp3",.75).setPrice(1e6).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(32).setDescription("An technologically advanced protogen").addPrerequisite("protogen")),this.shop.items.push(new a(this,"cheddar-cheese","Cheddar Cheese","cheddar.png",100,1).setDescription("Tasty cheddar! It's in the name!").setPrice(100).setMerpsMultiplier(1)),this.shop.items.push(new a(this,"slice-cheese","Slice Cheese","slice.png",750,1).setDescription("Processed sliced cheese. It's only redeeming quality is that it's good in toasties.").addPrerequisite("cheddar-cheese").setPrice(750).setMerpsMultiplier(1)),this.shop.items.push(new a(this,"mozzarella-cheese","Mozzarella Cheese","mozzarella.png").setDescription("Supposedly healthier for your serg. Makes good cheese pulls.").addPrerequisite("slice-cheese").setPrice(1500).setMerpsMultiplier(2)),this.shop.items.push(new a(this,"swiss-cheese","Swiss Cheese","swiss.png").setDescription("Sergs like holes, including those found in swiss cheese!").addPrerequisite("mozzarella-cheese").setPrice(1e4).setMerpsMultiplier(4)),this.shop.items.push(new a(this,"brie-cheese","Brie Cheese","brie.png").setDescription("Often enjoyed with crackers, but you don't have any.").addPrerequisite("swiss-cheese").setPrice(1e5).setMerpsMultiplier(8)),this.shop.items.push(new a(this,"parmesan-cheese","Parmesan Cheese","parmesan.png").setDescription("Underrated.").addPrerequisite("brie-cheese").setPrice(1e6).setMerpsMultiplier(16)),this.shop.items.push(new a(this,"pule-cheese","Pule Cheese","pule.png").setDescription("The world's most expensive cheese for your most precious sergos!").addPrerequisite("parmesan-cheese").setPrice(1e7).setMerpsMultiplier(32)),this.shop.items.push(new e(this,"manual-merping-1","Enhanced Manual Merps","enhanced-manual-merps.png").setDescription("Your cursor is pointier, this makes clicking sergals 50% more efficient.<br><i>+50% merps per click</i>").setPrice(1500).setCanOnlyOwnOne().setUnlocksAt(1e3)),this.shop.items.push(new e(this,"manual-merping-2","Further Enhanced Manual Merps","further-enhanced-manual-merps.png").setDescription("Your cursor is *even* pointier.<br><i>+50% merps per click</i>").setPrice(15e3).setCanOnlyOwnOne().addPrerequisite("manual-merping-1").setUnlocksAt(1e4)),this.shop.items.push(new e(this,"falling-cheese-upgrade-1","Tastier Cheese","cheese-upgrade-1.png").setDescription("Even tastier falling cheese yields more merps when clicked.<br><i>10x multiplier on falling cheese</i>").setPrice(25e4).setCanOnlyOwnOne().addPrerequisite("brie-cheese")),this.shop.items.push(new e(this,"falling-cheese-upgrade-2","Tastiest Cheese","cheese-upgrade-1.png").setDescription("The falling cheese is irresistible! Even more merps are harvested when clicked.<br><i>100x multiplier on falling cheese</i>").setPrice(25e5).setCanOnlyOwnOne().addPrerequisite("falling-cheese-upgrade-1").addPrerequisite("parmesan-cheese")),this.shop.items.push(new e(this,"space-background","Space Sergals","space-background-icon.png").setDescription("Sergals in space :3").setPrice(1e3).setUnlocksAt(1e5).setCanOnlyOwnOne().setCallback((()=>{this.sergalContainer.style.background='url("img/space-background.jpg")'}))),this.load()||this.shop.byId("sergal").increment(!0),this.startCheeseDropEffect(),document.addEventListener("mousemove",(e=>{this.mouseX=e.clientX,this.mouseY=e.clientY})),this.update(),setInterval((()=>{this.update()}),1e3),setInterval((()=>{this._autosaveEnabled&&this.save()}),5e3)},merp(e=1){this.merps+=e,this.highestMerps=Math.max(this.merps,this.highestMerps),this.update()},get merpsPerSecond(){let e=0;for(let t of this.shop.items)e+=t.owned*t.merpsPerSecond*this.merpMultiplier;return e},get merpMultiplier(){let e=0;for(let t of this.shop.items)e+=(t.merpsMultiplier??0)*t.owned;return e},get merpClickMultiplier(){let e=1;return this.shop.byId("manual-merping-1").owned>0&&(e+=.5),this.shop.byId("manual-merping-2").owned>0&&(e+=.5),e*Math.max(this.merpMultiplier,1)},get fallingCheeseClickMultiplier(){let e=1;return this.shop.byId("falling-cheese-upgrade-1").owned>0&&(e=10),this.shop.byId("falling-cheese-upgrade-2").owned>0&&(e=100),e},save(){let e={format:1,merps:this.merps,highestMerps:this.highestMerps,buyLog:this.buyLog};window.localStorage.saveData=JSON.stringify(e)},load(){if(!window.localStorage.saveData)return!1;const e=JSON.parse(window.localStorage.saveData);if(1!==e.format)return alert("Existing save isn't compatible with this version. Your save will be lost."),!1;this.merps=e.merps,this.highestMerps=e.highestMerps;for(let t of e.buyLog)this.shop.byId(t.id).increment(t.noPriceIncrease);return!0},async exportSave(){this.save(),prompt("Copy this save data...",await async function(e){return window.localStorage.saveData}())},async importSave(){const e=prompt("Enter save data...");if(!e)return;const t=await async function(e){return e}(e),s=JSON.parse(t);1===s.format?confirm(`Merp Clicker Save\n\nMerps: ${i(s.merps)}\nHighest Merps: ${i(s.highestMerps)}\nBought Items: ${s.buyLog.length}\n\nDo you want to continue loading? Your current save will be overwritten.`)&&(this._autosaveEnabled=!1,window.localStorage.saveData=t,window.location.reload()):alert("This save isn't compatible with this version.")},clearSave(){confirm("Are you sure you want to clear your Merp Clicker save?")&&(delete window.localStorage.saveData,window.location.reload())},update(){if(this._merpsLastUpdate!==this.merps){for(let e of this.merpCountElements)e.innerText=i(this.merps,2);for(let e of this.mpsElements)e.innerText=i(this.merpsPerSecond);this.updateShopContainer(),this.merps>=15&&this.shopContainer.classList.contains("hidden")&&this.shopContainer.classList.remove("hidden"),this._merpsLastUpdate=this.merps}},updateShopContainer(e=!1){const t=e=>!(e.canOnlyOwnOne&&e.owned>0||!e.prerequisites.every((e=>this.shop.items.find((t=>t.id===e&&t.owned>0))))||this.highestMerps<e.unlocksAtMerps);if(!e){let e=[],s=[];for(let i of this.shop.items)this.merps>=i.price&&s.push(i),t(i)&&e.push(i);if(this._lastCanAfford&&s.length===this._lastCanAfford.length&&s.every(((e,t)=>e===this._lastCanAfford[t])))return;if(this._lastVisibleInShop&&e.length===this._lastVisibleInShop&&e.every(((e,t)=>e===this._lastVisibleInShop[t])))return;this._lastCanAfford=s,this._lastVisibleInShop=e}const s=this.shopContainer.querySelector(".items");for(let e of s.querySelectorAll(".item"))e.remove();const r=s.querySelector("template");for(const e of this.shop.items){if(!t(e))continue;const n=r.content.cloneNode(!0);for(const t of n.querySelectorAll("[data-item-name]"))t.innerText=e.name;if(e.description)for(const t of n.querySelectorAll("[data-item-description]"))t.innerHTML=e.description;for(const t of n.querySelectorAll("[data-item-price]"))t.innerText=i(e.price);for(const t of n.querySelectorAll("[data-item-count]"))e.canOnlyOwnOne||(t.innerText=i(e.owned));e.icon&&(n.querySelector("img.item-icon").src="img/"+e.icon);let a=n.querySelector(".item-buy");e.price>this.merps?a.classList.add("item-cannot-afford"):(a.classList.add("item-can-afford"),a.addEventListener("click",(()=>{this.merps<e.price||(this.merps-=e.price,e.increment(),this.updateShopContainer(!0))}))),s.appendChild(n)}},async startCheeseDropEffect(){for(;;){if(0===this.merpsPerSecond){await new Promise((e=>setTimeout(e,1e3)));continue}let e=1/(this.merpsPerSecond/10)*1e3;e=Math.min(Math.max(e,200),4e3),await new Promise((t=>setTimeout(t,e))),e&&this.dropCheeseEffect()}},dropCheeseEffect(){let e=[];for(let t of this.shop.items)t instanceof a&&t.owned>0&&e.push(t);if(e.length>0){let s=e[Math.floor(Math.random()*e.length)],i=function(e,s,i,r,n,a=null){let o=document.createElement("img");return o.classList.add(i),o.src=r,t(e,s,o,n,a)}(Math.random()*this.sergalContainer.clientWidth,0,"cheese-drop-mote","img/"+s.icon,3e3,this.sergalContainer);i.addEventListener("mousedown",(()=>{const e=10*s.merpsMultiplier*this.fallingCheeseClickMultiplier;this.merp(e);const r=document.createElement("div");r.classList.add("merp-mote"),r.innerText="merp +"+e,t(this.mouseX,this.mouseY,r,500),i.remove()}))}}},window.addEventListener("load",(()=>{Game.setup()}))})();