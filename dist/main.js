(()=>{"use strict";class e{constructor(e,t){this.name=e,this.icon=t,this.description=null,this.price=0,this.nextPurchasePriceMultiplier=1,this.merpsPerSecond=0,this.merpsMultiplier=0,this.prerequisites=[],this.callback=null,this.owned=0}setName(e){return this.name=e,this}setIcon(e){return this.icon=e,this}setDescription(e){return this.description=e,this}setPrice(e){return this.price=e,this}setNextPurchasePriceMultiplier(e){return this.nextPurchasePriceMultiplier=e,this}setMerpsPerSecond(e){return this.merpsPerSecond=e,this}setMerpsMultiplier(e){return this.merpsMultiplier=e,this}setPrerequisites(e){return this.prerequisites=e,this}addPrerequisite(e){return this.prerequisites.push(e),this}setCallback(e){return this.callback=e,this}increment(e=!1){e||(this.price=Math.round(this.price*this.nextPurchasePriceMultiplier)),this.owned++,this.callback&&this.callback()}get canOnlyOwnOne(){return!this.nextPurchasePriceMultiplier}}function t(e,t,s,i,r){r=r??document.body,s.classList.add("mote"),s.style.position="absolute",s.style.left=e+"px",s.style.top=t+"px",s.style.animationDuration=i/1e3+"s",0===r.childElementCount?r.appendChild(s):r.insertBefore(s,r.firstChild),setTimeout((()=>{s.remove()}),i-50)}const s=["uwu","owo",">:3",">///<","gib cheese","wedj","pointy","beep"];class i extends e{constructor(e,t,s,i,r=1){super(e,t),this.defaultImage=s,this.openImage=i,this.volume=r,this.callback=this._callback}async _callback(){const e=document.createElement("div");e.classList.add("sergal"),e.dataset.shopId="0",e.dataset.lastMerp=(new Date).getTime().toString();const i=document.createElement("img");i.src=this.defaultImage,i.alt="Sergal",i.draggable=!1,e.appendChild(i),Game.sergalContainer.appendChild(e),Game.sergals.push(e),e.merpDown=(r,n)=>{r?.preventDefault(),n=n??this.merpsPerSecond,i.src=this.openImage,function(e,t=1){const s=document.createElement("audio");s.src=e,s.volume=t,s.play().catch((()=>{s.remove()})),s.addEventListener("ended",(()=>{s.remove()}))}("merp.mp3",this.volume);const o=e.getBoundingClientRect();let a=o.x+150*Math.random();const l=document.createElement("div");l.classList.add("merp-mote"),l.innerText="merp +"+this.merpsPerSecond,Math.random()<.01&&(l.innerText=s[Math.floor(Math.random()*s.length)]),t(a,o.y,l,500),Game.merp(n)},e.merpUp=()=>{i.src=this.defaultImage},e.addEventListener("mousedown",e.merpDown),e.addEventListener("mouseup",e.merpUp),e.addEventListener("mouseleave",e.merpUp),e.addEventListener("touchstart",e.merpDown),e.addEventListener("touchend",e.merpUp),e.addEventListener("touchcancel",e.merpUp),e.addEventListener("contextmenu",(e=>{e.preventDefault()}));let r=new Date;for(await new Promise((e=>setTimeout(e,1e3*Math.random())));;){await new Promise((e=>setTimeout(e,250*Math.random()-125+1e3)));let t=(new Date-r)/1e3;r=new Date;let s=this.merpsPerSecond*Game.merpsMultiplier*t;0!==s&&(e.merpDown(null,s),await new Promise((e=>setTimeout(e,100))),e.merpUp())}}}class r extends e{constructor(e,t,s,i){super(e,t),this.price=s,this.merpsMultiplier=i}get canOnlyOwnOne(){return!0}}function n(e,t){return 0===t?Math.round(e):parseFloat(e.toString()).toFixed(t).replace(/\.?0+$/,"")}function o(e,t=1,s=!0){return e<1e3?n(e,s?0:t)+"":e<1e6?n(e/1e3,t)+"k":e<1e9?n(e/1e6,t)+"M":n(e/1e9,t)+"B"}window.Game={el:null,merps:0,nextSergalCost:100,_merpsLastUpdate:null,_lastUpdateAt:new Date,_lastCanAfford:null,sergalContainer:null,shopContainer:null,merpCountElements:null,mpsElements:null,sergals:[],shop:new class{constructor(){this.items=[]}},setup(){this.el=document.getElementsByTagName("main")[0],this.sergalContainer=Game.el.getElementsByClassName("sergals")[0],this.shopContainer=Game.el.getElementsByClassName("shop")[0],this.merpCountElements=Game.el.querySelectorAll("[data-merp-count]"),this.mpsElements=Game.el.querySelectorAll("[data-mps]");let e=new r("Cheddar Cheese","cheddar.png",100,1).setDescription("Tasty cheddar! It's in the name!").setPrice(100).setMerpsMultiplier(1),t=new r("Mozzarella Cheese","mozzarella.png").setDescription("Supposedly healthier for your serg. Makes good cheese pulls.").addPrerequisite(e).setPrice(1e3).setMerpsMultiplier(2),s=new r("Swiss Cheese","swiss.png").setDescription("Sergs like holes, including those found in swiss cheese!").addPrerequisite(t).setPrice(1e4).setMerpsMultiplier(4),n=new r("Brie Cheese","brie.png").setDescription("Often enjoyed with crackers.").addPrerequisite(s).setPrice(1e5).setMerpsMultiplier(8),o=new r("Parmesan Cheese","parmesan.png").setDescription("You wouldn't eat this on it's own but your sergs will!").addPrerequisite(n).setPrice(1e6).setMerpsMultiplier(16),a=new r("Pule Cheese","pule.png").setDescription("The world's most expensive cheese for your most precious sergos!").addPrerequisite(o).setPrice(1e7).setMerpsMultiplier(32);const l=new i("Sergal","merp-icon.png","img/sergal-1.png","img/sergal-2.png",.25).setPrice(150).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(1).setDescription("A sergal :3").addPrerequisite(e),p=new i("Pink Sergal","pinksergal-1.png","img/pinksergal-1.png","img/pinksergal-2.png",.5).setPrice(1e3).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(4).setDescription("Happy pink sergals.").addPrerequisite(e),c=new i("Dark Sergal","darksergal-1.png","img/darksergal-1.png","img/darksergal-2.png",.75).setPrice(1e4).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(8).setDescription("These gray sergals might look scary but they're actually just as fluffy.").addPrerequisite(p),h=new i("Protogen","proto-1.png","img/proto-1.png","img/proto-2.png",.75).setPrice(1e5).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(16).setDescription("digital serg").addPrerequisite(c),u=new i("Synth","synth-1.png","img/synth-1.png","img/synth-2.png",1).setPrice(1e6).setNextPurchasePriceMultiplier(2).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(32).setDescription("An technologically advanced protogen").addPrerequisite(h);this.shop.items.push(l),this.shop.items.push(p),this.shop.items.push(c),this.shop.items.push(h),this.shop.items.push(u),this.shop.items.push(e),this.shop.items.push(t),this.shop.items.push(s),this.shop.items.push(n),this.shop.items.push(o),this.shop.items.push(a),l.increment(!0),this.update(),setInterval((()=>{this.update()}),1e3),this.startCheeseDropEffect()},merp(e=1){this.merps+=e,this.update()},get merpsPerSecond(){let e=0;for(let t of this.shop.items)e+=t.owned*t.merpsPerSecond*this.merpsMultiplier;return e},get merpsMultiplier(){let e=0;for(let t of this.shop.items)e+=(t.merpsMultiplier??0)*t.owned;return e},update(){const e=this._merpsLastUpdate!==this.merps;for(let e of this.merpCountElements)e.innerText=o(this.merps,2);for(let e of this.mpsElements)e.innerText=o(this.merpsPerSecond);e&&this.updateShopContainer(),this._merpsLastUpdate=this.merps},updateShopContainer(e=!1){if(!e){let e=[];for(let t of this.shop.items)this.merps>=t.price&&e.push(t);if(this._lastCanAfford&&e.length===this._lastCanAfford.length&&e.every(((e,t)=>e===this._lastCanAfford[t])))return;this._lastCanAfford=e}const t=this.shopContainer.querySelector(".items");for(let e of t.querySelectorAll(".item"))e.remove();const s=t.querySelector("template");for(const e of this.shop.items){if(e.canOnlyOwnOne&&e.owned>0)continue;if(!e.prerequisites.every((e=>this.shop.items.find((t=>t===e&&t.owned>0)))))continue;const i=s.content.cloneNode(!0);for(const t of i.querySelectorAll("[data-item-name]"))t.innerText=e.name;if(e.description)for(const t of i.querySelectorAll("[data-item-description]"))t.innerText=e.description;for(const t of i.querySelectorAll("[data-item-price]"))t.innerText=o(e.price);for(const t of i.querySelectorAll("[data-item-count]"))e.canOnlyOwnOne||(t.innerText=o(e.owned));e.icon&&(i.querySelector("img.item-icon").src="img/"+e.icon);let r=i.querySelector(".item-buy");e.price>this.merps?r.classList.add("item-cannot-afford"):(r.classList.add("item-can-afford"),r.addEventListener("click",(()=>{this.merps<e.price||(this.merps-=e.price,e.increment(),this.updateShopContainer(!0))}))),t.appendChild(i)}},async startCheeseDropEffect(){for(;;){if(0===this.merpsPerSecond){await new Promise((e=>setTimeout(e,1e3)));continue}let e=1/(this.merpsPerSecond/2)*1e3;e=Math.max(e,200),await new Promise((t=>setTimeout(t,e))),e&&this.dropCheeseEffect()}},dropCheeseEffect(){let e=[];for(let t of this.shop.items)t instanceof r&&t.owned>0&&e.push(t);if(e.length>0){let s=e[Math.floor(Math.random()*e.length)];!function(e,s,i,r,n,o=null){let a=document.createElement("img");a.classList.add(i),a.src=r,t(e,s,a,n,o)}(Math.random()*this.sergalContainer.clientWidth,0,"cheese-drop-mote","img/"+s.icon,3e3,this.sergalContainer)}}},window.addEventListener("load",(()=>{Game.setup()}))})();