(()=>{"use strict";class e{constructor(e,t){this.name=e,this.icon=t,this.description=null,this.price=0,this.nextPurchasePriceMultiplier=1,this.merpsPerSecond=0,this.merpsMultiplier=0,this.prerequisites=[],this.unlocksAtMerps=0,this.callback=null,this.owned=0}setName(e){return this.name=e,this}setIcon(e){return this.icon=e,this}setDescription(e){return this.description=e,this}setPrice(e){return this.price=e,this}setNextPurchasePriceMultiplier(e){return this.nextPurchasePriceMultiplier=e,this}setMerpsPerSecond(e){return this.merpsPerSecond=e,this}setMerpsMultiplier(e){return this.merpsMultiplier=e,this}setPrerequisites(e){return this.prerequisites=e,this}setUnlocksAt(e){return this.unlocksAtMerps=e,this}addPrerequisite(e){return this.prerequisites.push(e),this}setCallback(e){return this.callback=e,this}setCanOnlyOwnOne(){return this.nextPurchasePriceMultiplier=null,this}increment(e=!1){e||(this.price=Math.round(this.price*this.nextPurchasePriceMultiplier)),this.owned++,this.callback&&this.callback()}get canOnlyOwnOne(){return!this.nextPurchasePriceMultiplier}}function t(e,t,s,i,r){return r=r??document.body,s.classList.add("mote"),s.style.position="absolute",s.style.left=e+"px",s.style.top=t+"px",s.style.animationDuration=i/1e3+"s",s.ondragstart=()=>!1,0===r.childElementCount?r.appendChild(s):r.insertBefore(s,r.firstChild),setTimeout((()=>{s.remove()}),i-50),s}function s(e,t){return 0===t?Math.round(e):parseFloat(e.toString()).toFixed(t).replace(/\.?0+$/,"")}function i(e,t=1,i=!0){return e<1e3?s(e,i?0:t)+"":e<1e6?s(e/1e3,t)+"k":e<1e9?s(e/1e6,t)+"M":s(e/1e9,t)+"B"}const r=["uwu","owo",">:3",">///<","gib cheese","wedj","pointy","beep"];class n extends e{constructor(e,t,s,i,r=1){super(e,t),this.defaultImage=s,this.openImage=i,this.volume=r,this.callback=this._callback}async _callback(){const e=document.createElement("div");e.classList.add("sergal"),e.dataset.shopId="0",e.dataset.lastMerp=(new Date).getTime().toString();const s=document.createElement("img");s.src=this.defaultImage,s.alt="Sergal",s.draggable=!1,e.appendChild(s),Game.sergalContainer.appendChild(e),Game.sergals.push(e),e.merpDown=(n,o)=>{n?.preventDefault(),o=o??1;const a=!!n;let l=this.merpsPerSecond*(a?Game.merpClickMultiplier:Game.merpMultiplier);if(0===l)return;s.src=this.openImage,function(e,t=1){const s=document.createElement("audio");s.src=e,s.volume=t,s.play().catch((()=>{s.remove()})),s.addEventListener("ended",(()=>{s.remove()}))}("merp.mp3",this.volume);const p=e.getBoundingClientRect();let h=p.x+150*Math.random();const c=document.createElement("div");c.classList.add("merp-mote"),c.innerText="merp +"+i(l,1),Math.random()<.01&&(c.innerText=r[Math.floor(Math.random()*r.length)]),t(h,p.y,c,500),Game.merp(l*o)},e.merpUp=()=>{s.src=this.defaultImage},e.addEventListener("mousedown",e.merpDown),e.addEventListener("mouseup",e.merpUp),e.addEventListener("mouseleave",e.merpUp),e.addEventListener("touchstart",e.merpDown),e.addEventListener("touchend",e.merpUp),e.addEventListener("touchcancel",e.merpUp),e.addEventListener("contextmenu",(e=>{e.preventDefault()}));let n=new Date;for(await new Promise((e=>setTimeout(e,1e3*Math.random())));;){await new Promise((e=>setTimeout(e,250*Math.random()-125+1e3)));let t=(new Date-n)/1e3;n=new Date,e.merpDown(null,t),await new Promise((e=>setTimeout(e,100))),e.merpUp()}}}class o extends e{constructor(e,t,s,i){super(e,t),this.price=s,this.merpsMultiplier=i}get canOnlyOwnOne(){return!0}}window.Game={el:null,merps:0,highestMerps:0,_merpsLastUpdate:null,_lastUpdateAt:new Date,_lastCanAfford:null,_lastVisibleInShop:null,sergalContainer:null,shopContainer:null,merpCountElements:null,mpsElements:null,mouseX:0,mouseY:0,sergals:[],manualMerping:null,shop:new class{constructor(){this.items=[]}},setup(){this.el=document.getElementsByTagName("main")[0],this.sergalContainer=Game.el.getElementsByClassName("sergals")[0],this.shopContainer=Game.el.getElementsByClassName("shop")[0],this.merpCountElements=Game.el.querySelectorAll("[data-merp-count]"),this.mpsElements=Game.el.querySelectorAll("[data-mps]");let t=new o("Cheddar Cheese","cheddar.png",100,1).setDescription("Tasty cheddar! It's in the name!").setPrice(100).setMerpsMultiplier(1),s=new o("Slice Cheese","slice.png",750,1).setDescription("Processed sliced cheese. It's only redeeming quality is that it's good in toasties.").addPrerequisite(t).setPrice(750).setMerpsMultiplier(1),i=new o("Mozzarella Cheese","mozzarella.png").setDescription("Supposedly healthier for your serg. Makes good cheese pulls.").addPrerequisite(s).setPrice(1500).setMerpsMultiplier(2),r=new o("Swiss Cheese","swiss.png").setDescription("Sergs like holes, including those found in swiss cheese!").addPrerequisite(i).setPrice(1e4).setMerpsMultiplier(4),a=new o("Brie Cheese","brie.png").setDescription("Often enjoyed with crackers.").addPrerequisite(r).setPrice(1e5).setMerpsMultiplier(8),l=new o("Parmesan Cheese","parmesan.png").setDescription("You wouldn't eat this on it's own but your sergs will!").addPrerequisite(a).setPrice(1e6).setMerpsMultiplier(16),p=new o("Pule Cheese","pule.png").setDescription("The world's most expensive cheese for your most precious sergos!").addPrerequisite(l).setPrice(1e7).setMerpsMultiplier(32);const h=new n("Sergal","merp-icon.png","img/sergal-1.png","img/sergal-2.png",.5).setPrice(150).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(1).setDescription("A sergal :3").addPrerequisite(t),c=new n("Pink Sergal","pinksergal-1.png","img/pinksergal-1.png","img/pinksergal-2.png",.6).setPrice(1e3).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(4).setDescription("Happy pink sergals.").addPrerequisite(t),u=new n("Dark Sergal","darksergal-1.png","img/darksergal-1.png","img/darksergal-2.png",.7).setPrice(1e4).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(8).setDescription("These gray sergals might look scary but they're actually just as fluffy.").addPrerequisite(c),m=new n("Protogen","proto-1.png","img/proto-1.png","img/proto-2.png",.8).setPrice(1e5).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(16).setDescription("digital serg").addPrerequisite(u),d=new n("Synth","synth-1.png","img/synth-1.png","img/synth-2.png",.9).setPrice(1e6).setNextPurchasePriceMultiplier(2).setMerpsPerSecond(32).setDescription("An technologically advanced protogen").addPrerequisite(m);this.manualMerping=new e("Enhanced Manual Merps","enhanced-manual-merps.png").setDescription("Your cursor is pointier, this makes clicking sergals 50% more efficient.").setPrice(1500).setCanOnlyOwnOne().setUnlocksAt(1e3),this.manualMerping2=new e("Further Enhanced Manual Merps","further-enhanced-manual-merps.png").setDescription("Your cursor is *even* pointier. It now has the ability to extract another 50% more merps per click.").setPrice(15e3).setCanOnlyOwnOne().addPrerequisite(this.manualMerping).setUnlocksAt(1e4),this.shop.items.push(h),this.shop.items.push(this.manualMerping),this.shop.items.push(this.manualMerping2),this.shop.items.push(c),this.shop.items.push(u),this.shop.items.push(m),this.shop.items.push(d),this.shop.items.push(t),this.shop.items.push(s),this.shop.items.push(i),this.shop.items.push(r),this.shop.items.push(a),this.shop.items.push(l),this.shop.items.push(p),h.increment(!0),this.update(),setInterval((()=>{this.update()}),1e3),this.startCheeseDropEffect(),document.addEventListener("mousemove",(e=>{this.mouseX=e.clientX,this.mouseY=e.clientY}))},merp(e=1){this.merps+=e,this.highestMerps=Math.max(this.merps,this.highestMerps),this.update()},get merpsPerSecond(){let e=0;for(let t of this.shop.items)e+=t.owned*t.merpsPerSecond*this.merpMultiplier;return e},get merpMultiplier(){let e=0;for(let t of this.shop.items)e+=(t.merpsMultiplier??0)*t.owned;return e},get merpClickMultiplier(){let e=1;return this.manualMerping.owned>0&&(e+=.5),this.manualMerping2.owned>0&&(e+=.5),e*Math.max(this.merpMultiplier,1)},update(){const e=this._merpsLastUpdate!==this.merps;for(let e of this.merpCountElements)e.innerText=i(this.merps,2);for(let e of this.mpsElements)e.innerText=i(this.merpsPerSecond);e&&this.updateShopContainer(),e&&this.merps>=15&&this.shopContainer.classList.contains("hidden")&&this.shopContainer.classList.remove("hidden"),this._merpsLastUpdate=this.merps},updateShopContainer(e=!1){const t=e=>!(e.canOnlyOwnOne&&e.owned>0||!e.prerequisites.every((e=>this.shop.items.find((t=>t===e&&t.owned>0))))||this.highestMerps<e.unlocksAtMerps);if(!e){let e=[],s=[];for(let i of this.shop.items)this.merps>=i.price&&s.push(i),t(i)&&e.push(i);if(this._lastCanAfford&&s.length===this._lastCanAfford.length&&s.every(((e,t)=>e===this._lastCanAfford[t])))return;if(this._lastVisibleInShop&&e.length===this._lastVisibleInShop&&e.every(((e,t)=>e===this._lastVisibleInShop[t])))return;this._lastCanAfford=s,this._lastVisibleInShop=e}const s=this.shopContainer.querySelector(".items");for(let e of s.querySelectorAll(".item"))e.remove();const r=s.querySelector("template");for(const e of this.shop.items){if(!t(e))continue;const n=r.content.cloneNode(!0);for(const t of n.querySelectorAll("[data-item-name]"))t.innerText=e.name;if(e.description)for(const t of n.querySelectorAll("[data-item-description]"))t.innerText=e.description;for(const t of n.querySelectorAll("[data-item-price]"))t.innerText=i(e.price);for(const t of n.querySelectorAll("[data-item-count]"))e.canOnlyOwnOne||(t.innerText=i(e.owned));e.icon&&(n.querySelector("img.item-icon").src="img/"+e.icon);let o=n.querySelector(".item-buy");e.price>this.merps?o.classList.add("item-cannot-afford"):(o.classList.add("item-can-afford"),o.addEventListener("click",(()=>{this.merps<e.price||(this.merps-=e.price,e.increment(),this.updateShopContainer(!0))}))),s.appendChild(n)}},async startCheeseDropEffect(){for(;;){if(0===this.merpsPerSecond){await new Promise((e=>setTimeout(e,1e3)));continue}let e=1/(this.merpsPerSecond/2)*1e3;e=Math.max(e,200),await new Promise((t=>setTimeout(t,e))),e&&this.dropCheeseEffect()}},dropCheeseEffect(){let e=[];for(let t of this.shop.items)t instanceof o&&t.owned>0&&e.push(t);if(e.length>0){let s=e[Math.floor(Math.random()*e.length)],i=function(e,s,i,r,n,o=null){let a=document.createElement("img");return a.classList.add(i),a.src=r,t(e,s,a,n,o)}(Math.random()*this.sergalContainer.clientWidth,0,"cheese-drop-mote","img/"+s.icon,3e3,this.sergalContainer);i.addEventListener("mousedown",(()=>{const e=10*s.merpsMultiplier;this.merp(e);const r=document.createElement("div");r.classList.add("merp-mote"),r.innerText="merp +"+e,t(this.mouseX,this.mouseY,r,500),i.remove()}))}}},window.addEventListener("load",(()=>{Game.setup()}))})();